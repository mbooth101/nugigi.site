<!DOCTYPE html>
<html>
<!--
Oi, there's nothing to see here!
Go on, off ya feck, ya nosey bastard!
-->
<head>
	<link rel="stylesheet" href="styles.css" />
	<meta property="og:type" content="website"/>
	<meta property="og:url" content="https://nugigi.site/katzeyear"/>
	<meta property="og:title" content="Katze Calendar"/>
	<meta property="og:description" content="Katze's Mercian-Umbrian Calendar to Gregorian Calendar conversion table."/>
	<style>
body { background-color: #e3dac9; color: #2e2014; }
.season { vertical-align: top; }
.month { margin: 0; padding: 0.5rem; }
.month p { margin: 0; padding: 0; }
.month p.today { font-weight: bold; color: darkred;}
	</style>
</head>
<body>
	<div>
	<h1>Katze Calendar</h1>
	<p>Katze's Mercian-Umbrian Calendar to Gregorian Calendar conversion table.</p>
	<p>The calendar has 9 months of 40 days each with a short Midwinter month that gains an extra day on leap years.</p>
	<p>
		<label for="startOffset">Offset from Gregorian year: <span id="startOffsetValue">0</span></label>
		<br/>
		<input type="range" id="startOffset" name="startOffset" min="0" max="120" value="78" onchange="update()" />
	</p>
	<p>
		Calendar for year: <input type="number" id="yearSelection" name="yearSelection" min="1800" max="2199" step="1" value="2025" onchange="update()" />
	</p>
	<p>
		<table>
			<tr><th>Spring</th><th>Harvest</th><th>Winter</th></tr>
			<tr>
				<td id="season_Spring" class="season season_Spring"></td>
				<td id="season_Harvest" class="season season_Harvest"></td>
				<td id="season_Winter" class="season season_Winter"></td>
			</tr>
		</table>
	</p>
	</div>
<script>
	// Function to get the day of the year for the given date e.g. 0 to 365
	const getDayOfYear = d => Math.floor((d - new Date(d.getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24)) - 1;

	// Function to get the total num of days in the year of the given date e.g. 365 or 366
	const getNumDaysInYear = d => getDayOfYear(new Date(d.getFullYear(), 11, 31)) + 1;

	// Function to append the correct (English) suffix to a given number, returns e.g. 1st, 5th, etc
	function ordinalSuffix(i) {
		let j = i % 10;
		if (j === 1) {
			return i + "st";
		}
		if (j === 2) {
			return i + "nd";
		}
		if (j === 3) {
			return i + "rd";
		}
		return i + "th";
	}

	// Lookup table for month names
	const kmonths = [
		"Sprouts",
		"Petals",
		"Leaves",
		"Bales",
		"Bushels",
		"Barrels",
		"Pyres",
		"Midwinter",
		"Hearths",
		"Candles"];

	function update() {
		const today = new Date();

		// Get year selection
		const year = parseInt(document.getElementById("yearSelection").value);

		const yearStart = new Date(year, 0, 1);

		// Update start of year offset value selection
		const offset = parseInt(document.getElementById("startOffset").value);
		document.getElementById("startOffsetValue").textContent = `${offset} days`;

		// Length of midwinter is the number of excess days after nine 40-day months
		// (I.e., will be 5 or 6 depending on whether it's a year or not)
		const numDays = getNumDaysInYear(yearStart);
		const excess = numDays - 360;

		// Clear previous output
		document.getElementById("season_Spring").innerHTML = '';
		document.getElementById("season_Harvest").innerHTML = '';
		document.getElementById("season_Winter").innerHTML = '';

		// Add month containers
		for (let i = 0; i < kmonths.length; i++) {
			let seasonElem;
			if (i < 3) {
				seasonElem = document.getElementById("season_Spring");
			} else if (i < 6) {
				seasonElem = document.getElementById("season_Harvest");
			} else {
				seasonElem = document.getElementById("season_Winter");
			}
			const monthElem = seasonElem.appendChild(document.createElement("div"));
			monthElem.setAttribute('id', `month_${kmonths.at(i)}`);
			monthElem.classList.add('month');
			monthElem.classList.add(`month_${kmonths.at(i)}`);
		}

		// For every day in a Katze year
		for (let dayOfYear = 0; dayOfYear < numDays; dayOfYear++) {

			// After day 280, we need to adjust to compensate for the excess days of the midwinter month
			const dayOfYearAdj = dayOfYear >= 280 + excess ? dayOfYear - excess : dayOfYear;

			// Calculate the Katze day and month using the adjusted day of year
			let kday = dayOfYearAdj % 40 + 1;
			let kmonth = Math.floor(dayOfYearAdj / 40);
			// Special case for the midwinter month
			if (dayOfYear >= 280 + excess) {
				kmonth++;
			}

			// Equiv day of Gregorian year is the Katze day of year adjusted by the start of year offset
			const dayOfGregorianYear = dayOfYear + offset;
			const gregDate = new Date(yearStart);
			gregDate.setDate(gregDate.getDate() + dayOfGregorianYear);

			// Render output
			const monthElem = document.getElementById(`month_${kmonths.at(kmonth)}`);
			const dateElem = monthElem.appendChild(document.createElement("p"));
			dateElem.classList.add('date');
			dateElem.classList.add(`date_${ordinalSuffix(kday)}`);
			if (gregDate.setHours(0,0,0,0) == today.setHours(0,0,0,0)) {
				dateElem.classList.add('today');
			}
			dateElem.textContent = `${ordinalSuffix(kday)} of ${kmonths.at(kmonth)} (${gregDate.toISOString().split('T')[0]})`;
		}
	}

	// Default to current year
	document.getElementById("yearSelection").value = new Date().getFullYear();
	update();
</script>
</body>
</html>
